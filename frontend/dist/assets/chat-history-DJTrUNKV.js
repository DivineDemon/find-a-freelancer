import{c as B,v as a,x as k,G as q,U as Se,j as n,C as we,P as O,z as T,a3 as re,ad as oe,at as ye,aq as H,ar as G,as as U,ao as Ce,B as A,I as ae,t as Q,au as je,n as Ne,ag as _e,ah as ee,am as te,a8 as Pe}from"./index-H8J98cVM.js";import{c as M,a as Ee,S as Ae}from"./index-Bf8ytCez.js";import{P as Re}from"./plus-Be2JcRR3.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],Me=B("paperclip",Te);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],De=B("smile",ke);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ne=B("wifi-off",Le);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Ie=B("wifi",Oe);function We(t,e){return a.useReducer((s,o)=>e[s][o]??s,t)}var I=t=>{const{present:e,children:s}=t,o=ze(e),r=typeof s=="function"?s({present:o.isPresent}):a.Children.only(s),i=k(o.ref,He(r));return typeof s=="function"||o.isPresent?a.cloneElement(r,{ref:i}):null};I.displayName="Presence";function ze(t){const[e,s]=a.useState(),o=a.useRef(null),r=a.useRef(t),i=a.useRef("none"),c=t?"mounted":"unmounted",[h,d]=We(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return a.useEffect(()=>{const f=F(o.current);i.current=h==="mounted"?f:"none"},[h]),q(()=>{const f=o.current,u=r.current;if(u!==t){const m=i.current,x=F(f);t?d("MOUNT"):x==="none"||f?.display==="none"?d("UNMOUNT"):d(u&&m!==x?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,d]),q(()=>{if(e){let f;const u=e.ownerDocument.defaultView??window,p=x=>{const N=F(o.current).includes(CSS.escape(x.animationName));if(x.target===e&&N&&(d("ANIMATION_END"),!r.current)){const C=e.style.animationFillMode;e.style.animationFillMode="forwards",f=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=C)})}},m=x=>{x.target===e&&(i.current=F(o.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",p),e.addEventListener("animationend",p),()=>{u.clearTimeout(f),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",p),e.removeEventListener("animationend",p)}}else d("ANIMATION_END")},[e,d]),{isPresent:["mounted","unmountSuspended"].includes(h),ref:a.useCallback(f=>{o.current=f?getComputedStyle(f):null,s(f)},[])}}function F(t){return t?.animationName||"none"}function He(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=e&&"isReactWarning"in e&&e.isReactWarning;return s?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=e&&"isReactWarning"in e&&e.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}function Ue(t,e){return a.useReducer((s,o)=>e[s][o]??s,t)}var K="ScrollArea",[ie,dt]=we(K),[Fe,j]=ie(K),le=a.forwardRef((t,e)=>{const{__scopeScrollArea:s,type:o="hover",dir:r,scrollHideDelay:i=600,...c}=t,[h,d]=a.useState(null),[f,u]=a.useState(null),[p,m]=a.useState(null),[x,g]=a.useState(null),[N,C]=a.useState(null),[l,b]=a.useState(0),[y,v]=a.useState(0),[R,E]=a.useState(!1),[W,z]=a.useState(!1),w=k(e,D=>d(D)),_=Se(r);return n.jsx(Fe,{scope:s,type:o,dir:_,scrollHideDelay:i,scrollArea:h,viewport:f,onViewportChange:u,content:p,onContentChange:m,scrollbarX:x,onScrollbarXChange:g,scrollbarXEnabled:R,onScrollbarXEnabledChange:E,scrollbarY:N,onScrollbarYChange:C,scrollbarYEnabled:W,onScrollbarYEnabledChange:z,onCornerWidthChange:b,onCornerHeightChange:v,children:n.jsx(O.div,{dir:_,...c,ref:w,style:{position:"relative","--radix-scroll-area-corner-width":l+"px","--radix-scroll-area-corner-height":y+"px",...t.style}})})});le.displayName=K;var ce="ScrollAreaViewport",de=a.forwardRef((t,e)=>{const{__scopeScrollArea:s,children:o,nonce:r,...i}=t,c=j(ce,s),h=a.useRef(null),d=k(e,h,c.onViewportChange);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),n.jsx(O.div,{"data-radix-scroll-area-viewport":"",...i,ref:d,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...t.style},children:n.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:o})})]})});de.displayName=ce;var P="ScrollAreaScrollbar",ue=a.forwardRef((t,e)=>{const{forceMount:s,...o}=t,r=j(P,t.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:c}=r,h=t.orientation==="horizontal";return a.useEffect(()=>(h?i(!0):c(!0),()=>{h?i(!1):c(!1)}),[h,i,c]),r.type==="hover"?n.jsx(Ye,{...o,ref:e,forceMount:s}):r.type==="scroll"?n.jsx(Xe,{...o,ref:e,forceMount:s}):r.type==="auto"?n.jsx(he,{...o,ref:e,forceMount:s}):r.type==="always"?n.jsx(J,{...o,ref:e}):null});ue.displayName=P;var Ye=a.forwardRef((t,e)=>{const{forceMount:s,...o}=t,r=j(P,t.__scopeScrollArea),[i,c]=a.useState(!1);return a.useEffect(()=>{const h=r.scrollArea;let d=0;if(h){const f=()=>{window.clearTimeout(d),c(!0)},u=()=>{d=window.setTimeout(()=>c(!1),r.scrollHideDelay)};return h.addEventListener("pointerenter",f),h.addEventListener("pointerleave",u),()=>{window.clearTimeout(d),h.removeEventListener("pointerenter",f),h.removeEventListener("pointerleave",u)}}},[r.scrollArea,r.scrollHideDelay]),n.jsx(I,{present:s||i,children:n.jsx(he,{"data-state":i?"visible":"hidden",...o,ref:e})})}),Xe=a.forwardRef((t,e)=>{const{forceMount:s,...o}=t,r=j(P,t.__scopeScrollArea),i=t.orientation==="horizontal",c=V(()=>d("SCROLL_END"),100),[h,d]=Ue("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return a.useEffect(()=>{if(h==="idle"){const f=window.setTimeout(()=>d("HIDE"),r.scrollHideDelay);return()=>window.clearTimeout(f)}},[h,r.scrollHideDelay,d]),a.useEffect(()=>{const f=r.viewport,u=i?"scrollLeft":"scrollTop";if(f){let p=f[u];const m=()=>{const x=f[u];p!==x&&(d("SCROLL"),c()),p=x};return f.addEventListener("scroll",m),()=>f.removeEventListener("scroll",m)}},[r.viewport,i,d,c]),n.jsx(I,{present:s||h!=="hidden",children:n.jsx(J,{"data-state":h==="hidden"?"hidden":"visible",...o,ref:e,onPointerEnter:M(t.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:M(t.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),he=a.forwardRef((t,e)=>{const s=j(P,t.__scopeScrollArea),{forceMount:o,...r}=t,[i,c]=a.useState(!1),h=t.orientation==="horizontal",d=V(()=>{if(s.viewport){const f=s.viewport.offsetWidth<s.viewport.scrollWidth,u=s.viewport.offsetHeight<s.viewport.scrollHeight;c(h?f:u)}},10);return L(s.viewport,d),L(s.content,d),n.jsx(I,{present:o||i,children:n.jsx(J,{"data-state":i?"visible":"hidden",...r,ref:e})})}),J=a.forwardRef((t,e)=>{const{orientation:s="vertical",...o}=t,r=j(P,t.__scopeScrollArea),i=a.useRef(null),c=a.useRef(0),[h,d]=a.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=ge(h.viewport,h.content),u={...o,sizes:h,onSizesChange:d,hasThumb:f>0&&f<1,onThumbChange:m=>i.current=m,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:m=>c.current=m};function p(m,x){return qe(m,c.current,h,x)}return s==="horizontal"?n.jsx(Be,{...u,ref:e,onThumbPositionChange:()=>{if(r.viewport&&i.current){const m=r.viewport.scrollLeft,x=se(m,h,r.dir);i.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:m=>{r.viewport&&(r.viewport.scrollLeft=m)},onDragScroll:m=>{r.viewport&&(r.viewport.scrollLeft=p(m,r.dir))}}):s==="vertical"?n.jsx($e,{...u,ref:e,onThumbPositionChange:()=>{if(r.viewport&&i.current){const m=r.viewport.scrollTop,x=se(m,h);i.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:m=>{r.viewport&&(r.viewport.scrollTop=m)},onDragScroll:m=>{r.viewport&&(r.viewport.scrollTop=p(m))}}):null}),Be=a.forwardRef((t,e)=>{const{sizes:s,onSizesChange:o,...r}=t,i=j(P,t.__scopeScrollArea),[c,h]=a.useState(),d=a.useRef(null),f=k(e,d,i.onScrollbarXChange);return a.useEffect(()=>{d.current&&h(getComputedStyle(d.current))},[d]),n.jsx(me,{"data-orientation":"horizontal",...r,ref:f,sizes:s,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":$(s)+"px",...t.style},onThumbPointerDown:u=>t.onThumbPointerDown(u.x),onDragScroll:u=>t.onDragScroll(u.x),onWheelScroll:(u,p)=>{if(i.viewport){const m=i.viewport.scrollLeft+u.deltaX;t.onWheelScroll(m),ve(m,p)&&u.preventDefault()}},onResize:()=>{d.current&&i.viewport&&c&&o({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:X(c.paddingLeft),paddingEnd:X(c.paddingRight)}})}})}),$e=a.forwardRef((t,e)=>{const{sizes:s,onSizesChange:o,...r}=t,i=j(P,t.__scopeScrollArea),[c,h]=a.useState(),d=a.useRef(null),f=k(e,d,i.onScrollbarYChange);return a.useEffect(()=>{d.current&&h(getComputedStyle(d.current))},[d]),n.jsx(me,{"data-orientation":"vertical",...r,ref:f,sizes:s,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":$(s)+"px",...t.style},onThumbPointerDown:u=>t.onThumbPointerDown(u.y),onDragScroll:u=>t.onDragScroll(u.y),onWheelScroll:(u,p)=>{if(i.viewport){const m=i.viewport.scrollTop+u.deltaY;t.onWheelScroll(m),ve(m,p)&&u.preventDefault()}},onResize:()=>{d.current&&i.viewport&&c&&o({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:X(c.paddingTop),paddingEnd:X(c.paddingBottom)}})}})}),[Ve,fe]=ie(P),me=a.forwardRef((t,e)=>{const{__scopeScrollArea:s,sizes:o,hasThumb:r,onThumbChange:i,onThumbPointerUp:c,onThumbPointerDown:h,onThumbPositionChange:d,onDragScroll:f,onWheelScroll:u,onResize:p,...m}=t,x=j(P,s),[g,N]=a.useState(null),C=k(e,w=>N(w)),l=a.useRef(null),b=a.useRef(""),y=x.viewport,v=o.content-o.viewport,R=T(u),E=T(d),W=V(p,10);function z(w){if(l.current){const _=w.clientX-l.current.left,D=w.clientY-l.current.top;f({x:_,y:D})}}return a.useEffect(()=>{const w=_=>{const D=_.target;g?.contains(D)&&R(_,v)};return document.addEventListener("wheel",w,{passive:!1}),()=>document.removeEventListener("wheel",w,{passive:!1})},[y,g,v,R]),a.useEffect(E,[o,E]),L(g,W),L(x.content,W),n.jsx(Ve,{scope:s,scrollbar:g,hasThumb:r,onThumbChange:T(i),onThumbPointerUp:T(c),onThumbPositionChange:E,onThumbPointerDown:T(h),children:n.jsx(O.div,{...m,ref:C,style:{position:"absolute",...m.style},onPointerDown:M(t.onPointerDown,w=>{w.button===0&&(w.target.setPointerCapture(w.pointerId),l.current=g.getBoundingClientRect(),b.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),z(w))}),onPointerMove:M(t.onPointerMove,z),onPointerUp:M(t.onPointerUp,w=>{const _=w.target;_.hasPointerCapture(w.pointerId)&&_.releasePointerCapture(w.pointerId),document.body.style.webkitUserSelect=b.current,x.viewport&&(x.viewport.style.scrollBehavior=""),l.current=null})})})}),Y="ScrollAreaThumb",pe=a.forwardRef((t,e)=>{const{forceMount:s,...o}=t,r=fe(Y,t.__scopeScrollArea);return n.jsx(I,{present:s||r.hasThumb,children:n.jsx(Ge,{ref:e,...o})})}),Ge=a.forwardRef((t,e)=>{const{__scopeScrollArea:s,style:o,...r}=t,i=j(Y,s),c=fe(Y,s),{onThumbPositionChange:h}=c,d=k(e,p=>c.onThumbChange(p)),f=a.useRef(void 0),u=V(()=>{f.current&&(f.current(),f.current=void 0)},100);return a.useEffect(()=>{const p=i.viewport;if(p){const m=()=>{if(u(),!f.current){const x=Ke(p,h);f.current=x,h()}};return h(),p.addEventListener("scroll",m),()=>p.removeEventListener("scroll",m)}},[i.viewport,u,h]),n.jsx(O.div,{"data-state":c.hasThumb?"visible":"hidden",...r,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:M(t.onPointerDownCapture,p=>{const x=p.target.getBoundingClientRect(),g=p.clientX-x.left,N=p.clientY-x.top;c.onThumbPointerDown({x:g,y:N})}),onPointerUp:M(t.onPointerUp,c.onThumbPointerUp)})});pe.displayName=Y;var Z="ScrollAreaCorner",xe=a.forwardRef((t,e)=>{const s=j(Z,t.__scopeScrollArea),o=!!(s.scrollbarX&&s.scrollbarY);return s.type!=="scroll"&&o?n.jsx(Qe,{...t,ref:e}):null});xe.displayName=Z;var Qe=a.forwardRef((t,e)=>{const{__scopeScrollArea:s,...o}=t,r=j(Z,s),[i,c]=a.useState(0),[h,d]=a.useState(0),f=!!(i&&h);return L(r.scrollbarX,()=>{const u=r.scrollbarX?.offsetHeight||0;r.onCornerHeightChange(u),d(u)}),L(r.scrollbarY,()=>{const u=r.scrollbarY?.offsetWidth||0;r.onCornerWidthChange(u),c(u)}),f?n.jsx(O.div,{...o,ref:e,style:{width:i,height:h,position:"absolute",right:r.dir==="ltr"?0:void 0,left:r.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function X(t){return t?parseInt(t,10):0}function ge(t,e){const s=t/e;return isNaN(s)?0:s}function $(t){const e=ge(t.viewport,t.content),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,o=(t.scrollbar.size-s)*e;return Math.max(o,18)}function qe(t,e,s,o="ltr"){const r=$(s),i=r/2,c=e||i,h=r-c,d=s.scrollbar.paddingStart+c,f=s.scrollbar.size-s.scrollbar.paddingEnd-h,u=s.content-s.viewport,p=o==="ltr"?[0,u]:[u*-1,0];return be([d,f],p)(t)}function se(t,e,s="ltr"){const o=$(e),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,i=e.scrollbar.size-r,c=e.content-e.viewport,h=i-o,d=s==="ltr"?[0,c]:[c*-1,0],f=Ee(t,d);return be([0,c],[0,h])(f)}function be(t,e){return s=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const o=(e[1]-e[0])/(t[1]-t[0]);return e[0]+o*(s-t[0])}}function ve(t,e){return t>0&&t<e}var Ke=(t,e=()=>{})=>{let s={left:t.scrollLeft,top:t.scrollTop},o=0;return function r(){const i={left:t.scrollLeft,top:t.scrollTop},c=s.left!==i.left,h=s.top!==i.top;(c||h)&&e(),s=i,o=window.requestAnimationFrame(r)}(),()=>window.cancelAnimationFrame(o)};function V(t,e){const s=T(t),o=a.useRef(0);return a.useEffect(()=>()=>window.clearTimeout(o.current),[]),a.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(s,e)},[s,e])}function L(t,e){const s=T(e);q(()=>{let o=0;if(t){const r=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(s)});return r.observe(t),()=>{window.cancelAnimationFrame(o),r.unobserve(t)}}},[t,s])}var Je=le,Ze=de,et=xe;function tt({className:t,children:e,...s}){return n.jsxs(Je,{"data-slot":"scroll-area",className:re("relative",t),...s,children:[n.jsx(Ze,{"data-slot":"scroll-area-viewport",className:"size-full rounded-[inherit] outline-none transition-[color,box-shadow] focus-visible:outline-1 focus-visible:ring-[3px] focus-visible:ring-ring/50",children:e}),n.jsx(nt,{}),n.jsx(et,{})]})}function nt({className:t,orientation:e="vertical",...s}){return n.jsx(ue,{"data-slot":"scroll-area-scrollbar",orientation:e,className:re("flex touch-none select-none p-px transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",t),...s,children:n.jsx(pe,{"data-slot":"scroll-area-thumb",className:"relative flex-1 rounded-full bg-border"})})}class st{ws=null;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;messageHandlers=new Map;connectionHandlers=new Map;isConnecting=!1;userId=null;token=null;constructor(){this.setupEventListeners()}setupEventListeners(){document.addEventListener("visibilitychange",()=>{!document.hidden&&this.ws?.readyState===WebSocket.CLOSED&&this.reconnect()}),window.addEventListener("online",()=>{this.ws?.readyState===WebSocket.CLOSED&&this.reconnect()})}connect(e,s){return new Promise((o,r)=>{if(this.isConnecting){r(new Error("Connection already in progress"));return}this.userId=e,this.token=s,this.isConnecting=!0;try{const i=`ws://localhost:8000/ws/${e}?token=${s}`;this.ws=new WebSocket(i),this.ws.onopen=()=>{this.isConnecting=!1,this.reconnectAttempts=0,this.notifyConnectionHandlers("connected"),o()},this.ws.onmessage=c=>{try{const h=JSON.parse(c.data);this.handleMessage(h)}catch{}},this.ws.onclose=c=>{this.isConnecting=!1,this.notifyConnectionHandlers("disconnected"),!c.wasClean&&this.reconnectAttempts<this.maxReconnectAttempts&&this.reconnect()},this.ws.onerror=c=>{this.isConnecting=!1,this.notifyConnectionHandlers("error"),r(new Error("WebSocket connection failed"))}}catch(i){this.isConnecting=!1,r(i)}})}disconnect(){this.ws&&(this.ws.close(1e3,"User initiated disconnect"),this.ws=null),this.userId=null,this.token=null}reconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return;this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{this.userId&&this.token&&this.connect(this.userId,this.token).catch(s=>{})},e)}sendMessage(e){this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}sendChatMessage(e,s,o="text"){const r={type:"chat",data:{chat_id:e,content:s,content_type:o},timestamp:new Date().toISOString()};this.sendMessage(r)}sendTypingIndicator(e,s){const o={type:"typing",data:{chat_id:e,is_typing:s},timestamp:new Date().toISOString()};this.sendMessage(o)}sendReadReceipt(e,s){const o={type:"read",data:{message_id:e,chat_id:s},timestamp:new Date().toISOString()};this.sendMessage(o)}joinChat(e){const s={type:"connection",data:{action:"join_chat",chat_id:e},timestamp:new Date().toISOString()};this.sendMessage(s)}leaveChat(e){const s={type:"connection",data:{action:"leave_chat",chat_id:e},timestamp:new Date().toISOString()};this.sendMessage(s)}handleMessage(e){const s=this.messageHandlers.get(e.type);s&&s(e.data||e)}onMessage(e,s){this.messageHandlers.set(e,s)}offMessage(e){this.messageHandlers.delete(e)}onConnection(e,s){this.connectionHandlers.set(e,s)}offConnection(e){this.connectionHandlers.delete(e)}notifyConnectionHandlers(e){const s=this.connectionHandlers.get(e);s&&s()}isConnected(){return this.ws?.readyState===WebSocket.OPEN}getConnectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"disconnected";default:return"unknown"}}}const S=new st;function rt(t){const{data:e}=oe(),[s,o]=a.useState([]),[r,i]=a.useState(!1),[c,h]=a.useState(new Set),d=a.useRef(0),f=a.useCallback(l=>{if(l&&typeof l=="object"&&l!==null&&"chat_id"in l){const b=l;if(b.chat_id===t.id){const y={id:b.id||Date.now(),content:b.content||"",content_type:b.content_type||"text",chat_id:b.chat_id,sender_id:b.sender_id||0,is_flagged:!1,flag_reason:null,is_edited:!1,original_content:null,is_deleted:!1,deleted_at:null,edited_at:null,created_at:b.timestamp||new Date().toISOString(),updated_at:b.timestamp||new Date().toISOString(),sender_name:b.sender_name||"Unknown",sender_type:b.sender_type||"client_hunter",sender_avatar:b.sender_avatar||null};o(v=>v.some(E=>E.id===y.id)?v:[...v,y])}}},[t.id]),u=a.useCallback(l=>{if(l&&typeof l=="object"&&l!==null&&"chat_id"in l){const b=l;b.chat_id===t.id&&(b.is_typing?h(y=>new Set([...y,b.user_id])):h(y=>{const v=new Set(y);return v.delete(b.user_id),v}))}},[t.id]),p=a.useCallback(l=>{if(l&&typeof l=="object"&&l!==null&&"message_id"in l){const b=l;o(y=>y.map(v=>v.id.toString()===b.message_id?{...v,is_read:!0}:v))}},[]);a.useEffect(()=>!e||!t?void 0:((async()=>{try{S.isConnected()||await S.connect(e.id,localStorage.getItem("accessToken")||""),S.joinChat(t.id),S.onMessage("chat",f),S.onMessage("typing",u),S.onMessage("read",p),S.onConnection("connected",()=>{i(!0)}),S.onConnection("disconnected",()=>{i(!1)}),S.onConnection("error",()=>{i(!1)})}catch{i(!1)}})(),()=>{t&&S.leaveChat(t.id),S.offMessage("chat"),S.offMessage("typing"),S.offMessage("read"),S.offConnection("connected"),S.offConnection("disconnected"),S.offConnection("error")}),[t?.id,e?.id,f,u,p,t,e]);const m=a.useCallback(async(l,b="text")=>{if(!l.trim()||!r)return!1;const y={id:++d.current,content:l.trim(),content_type:b,chat_id:t.id,sender_id:e.id,is_flagged:!1,flag_reason:null,is_edited:!1,original_content:null,is_deleted:!1,deleted_at:null,edited_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),sender_name:`${e.first_name} ${e.last_name}`,sender_type:e.user_type,sender_avatar:e.profile_picture||null,isLocal:!0};o(v=>[...v,y]);try{return S.sendChatMessage(t.id,l.trim(),b),!0}catch{return o(R=>R.filter(E=>E.id!==y.id)),!1}},[t.id,e,r]),x=a.useCallback(l=>{r&&S.sendTypingIndicator(t.id,l)},[t.id,r]),g=a.useCallback(l=>{r&&S.sendReadReceipt(l,t.id)},[t.id,r]),N=a.useCallback(l=>{o(l.map(b=>({...b,isLocal:!1})))},[]),C=a.useCallback((l,b)=>{o(y=>y.map(v=>v.id===l?{...b,isLocal:!1}:v))},[]);return{messages:s,isConnected:r,typingUsers:c,sendMessage:m,sendTypingIndicator:x,sendReadReceipt:g,initializeMessages:N,updateLocalMessage:C}}function ot({chat:t,currentUserId:e,onMessageSent:s}){const[o,r]=a.useState(""),i=a.useRef(null),{data:c}=ye({chatId:t.id,page:1,size:50}),{messages:h,isConnected:d,typingUsers:f,sendMessage:u,sendTypingIndicator:p,initializeMessages:m}=rt(t);a.useEffect(()=>{c?.messages&&m(c.messages)},[c?.messages,m]),a.useEffect(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[]),a.useEffect(()=>{const l=setTimeout(()=>{p(!1)},1e3);return()=>clearTimeout(l)},[p]);const x=async()=>{if(o.trim())try{await u(o.trim(),"text")?(r(""),s?.(),Q.success("Message sent!")):Q.error("Failed to send message - not connected")}catch{Q.error("Failed to send message")}},g=l=>{l.key==="Enter"&&!l.shiftKey?(l.preventDefault(),x()):p(!0)},N=l=>new Date(l).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),C=()=>t.initiator_id===e?t.participant_name:t.initiator_name;return n.jsxs("div",{className:"flex h-full flex-col",children:[n.jsx("div",{className:"border-b px-4 py-3",children:n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs(H,{className:"h-10 w-10",children:[n.jsx(G,{src:"",alt:C()}),n.jsx(U,{children:C().split(" ").map(l=>l[0]).join("")})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold",children:C()}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Ce,{variant:d?"default":"secondary",children:d?n.jsxs(n.Fragment,{children:[n.jsx(Ie,{className:"mr-1 h-3 w-3"}),"Connected"]}):n.jsxs(n.Fragment,{children:[n.jsx(ne,{className:"mr-1 h-3 w-3"}),"Disconnected"]})}),f.size>0&&n.jsxs("span",{className:"text-muted-foreground text-sm",children:[C()," is typing..."]})]})]})]})})}),n.jsx("div",{className:"flex-1 overflow-hidden",children:n.jsx(tt,{className:"h-full px-4",ref:i,children:n.jsxs("div",{className:"space-y-4 py-4",children:[h.map(l=>n.jsxs("div",{className:`flex gap-3 ${l.sender_id===e?"justify-end":"justify-start"}`,children:[l.sender_id!==e&&n.jsxs(H,{className:"h-8 w-8 flex-shrink-0",children:[n.jsx(G,{src:l.sender_avatar||"",alt:l.sender_name}),n.jsx(U,{className:"text-xs",children:l.sender_name.split(" ").map(b=>b[0]).join("")})]}),n.jsxs("div",{className:`max-w-[70%] rounded-lg px-3 py-2 ${l.sender_id===e?"bg-primary text-primary-foreground":"bg-muted"}`,children:[n.jsxs("div",{className:"mb-1 flex items-center gap-2",children:[n.jsx("span",{className:"font-medium text-xs",children:l.sender_id===e?"You":l.sender_name}),n.jsx("span",{className:"text-xs opacity-70",children:N(l.created_at)})]}),n.jsx("p",{className:"text-sm",children:l.content}),l.is_edited&&n.jsx("span",{className:"text-xs opacity-70",children:"(edited)"}),l.isLocal&&n.jsx("span",{className:"text-blue-500 text-xs opacity-70",children:"(sending...)"})]}),l.sender_id===e&&n.jsxs(H,{className:"h-8 w-8 flex-shrink-0",children:[n.jsx(G,{src:"",alt:"You"}),n.jsx(U,{className:"text-xs",children:"You"})]})]},l.id)),f.size>0&&n.jsxs("div",{className:"flex justify-start gap-3",children:[n.jsx(H,{className:"h-8 w-8 flex-shrink-0",children:n.jsx(U,{className:"text-xs",children:C().split(" ").map(l=>l[0]).join("")})}),n.jsx("div",{className:"rounded-lg bg-muted px-3 py-2",children:n.jsx("div",{className:"flex items-center gap-1",children:n.jsxs("div",{className:"flex gap-1",children:[n.jsx("div",{className:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground"}),n.jsx("div",{className:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground",style:{animationDelay:"0.1s"}}),n.jsx("div",{className:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground",style:{animationDelay:"0.2s"}})]})})})]})]})})}),n.jsx("div",{className:"border-t p-4",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx(A,{variant:"outline",size:"icon",className:"flex-shrink-0",children:n.jsx(Me,{className:"h-4 w-4"})}),n.jsx(A,{variant:"outline",size:"icon",className:"flex-shrink-0",children:n.jsx(De,{className:"h-4 w-4"})}),n.jsx(ae,{value:o,onChange:l=>r(l.target.value),onKeyPress:g,placeholder:"Type your message...",className:"flex-1",disabled:!d}),n.jsx(A,{onClick:x,disabled:!o.trim()||!d,size:"icon",className:"flex-shrink-0",children:d?n.jsx(Ae,{className:"h-4 w-4"}):n.jsx(ne,{className:"h-4 w-4"})})]})})]})}const ut=function(){const[e,s]=a.useState(""),[o,r]=a.useState(""),[i,c]=a.useState(null),[h,d]=a.useState(!1),{data:f}=oe(),{data:u,isLoading:p}=je({statusFilter:o||void 0,page:1,size:20});if(p)return n.jsx("div",{className:"flex h-full w-full items-center justify-center",children:n.jsx(Ne,{className:"size-20 animate-spin"})});const m=u?.chats||[],x=u?.chats.find(g=>g.id===i);return i&&x&&f?n.jsxs("div",{className:"flex h-full w-full flex-col",children:[n.jsx("div",{className:"border-b px-4 py-3",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(A,{variant:"outline",size:"sm",onClick:()=>c(null),children:"← Back to Chats"}),n.jsxs("h1",{className:"font-bold text-xl",children:["Chat with ",x.participant_name]})]})}),n.jsx("div",{className:"flex-1",children:n.jsx(ot,{chat:x,currentUserId:f.id,onMessageSent:()=>{}})})]}):n.jsxs("div",{className:"flex h-full w-full flex-col items-start justify-start py-5",children:[n.jsx(_e,{children:n.jsxs("div",{className:"w-full space-y-6",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{children:[n.jsx("h1",{className:"font-bold text-3xl",children:"Messages"}),n.jsx("p",{className:"text-muted-foreground",children:"Manage your conversations and project discussions"})]})}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"flex-1",children:n.jsx(ae,{placeholder:"Search chats...",value:e,onChange:g=>s(g.target.value),className:"max-w-sm"})}),n.jsxs("select",{value:o,onChange:g=>r(g.target.value),className:"rounded-md border border-input bg-background px-3 py-2 text-sm",children:[n.jsx("option",{value:"",children:"All Status"}),n.jsx("option",{value:"active",children:"Active"}),n.jsx("option",{value:"archived",children:"Archived"})]})]}),n.jsx("div",{className:"grid gap-4",children:m.length===0?n.jsx(ee,{children:n.jsxs(te,{className:"flex flex-col items-center justify-center py-12",children:[n.jsx(Pe,{className:"mb-4 h-12 w-12 text-muted-foreground"}),n.jsx("h3",{className:"mb-2 font-semibold text-lg",children:"No conversations yet"}),n.jsx("p",{className:"mb-4 text-center text-muted-foreground",children:"Start a conversation with a client or freelancer to begin your project collaboration."}),n.jsxs(A,{onClick:()=>d(!0),children:[n.jsx(Re,{className:"mr-2 h-4 w-4"}),"Start New Chat"]})]})}):m.map(g=>n.jsx(ee,{className:"cursor-pointer transition-colors hover:bg-muted/50",onClick:()=>c(g.id),children:n.jsx(te,{className:"p-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"mb-2 flex items-center gap-3",children:[n.jsx("h3",{className:"font-semibold",children:g.title||`Chat with ${g.participant_name}`}),n.jsx("span",{className:`rounded-full px-2 py-1 text-xs ${g.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:g.status})]}),n.jsx("p",{className:"mb-2 text-muted-foreground text-sm",children:g.project_title&&`Project: ${g.project_title}`}),g.last_message_preview&&n.jsx("p",{className:"truncate text-muted-foreground text-sm",children:g.last_message_preview})]}),n.jsxs("div",{className:"text-right text-muted-foreground text-sm",children:[n.jsxs("div",{children:[g.unread_count||0," unread"]}),n.jsx("div",{children:new Date(g.updated_at).toLocaleDateString()})]})]})})},g.id))}),u&&u.total>20&&n.jsxs("div",{className:"flex items-center justify-center gap-2",children:[n.jsx(A,{variant:"outline",disabled:!u.has_prev,children:"Previous"}),n.jsxs("span",{className:"text-muted-foreground text-sm",children:["Page ",u.page," of ",Math.ceil(u.total/u.size)]}),n.jsx(A,{variant:"outline",disabled:!u.has_next,children:"Next"})]})]})}),h&&n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:n.jsxs("div",{className:"mx-4 w-full max-w-md rounded-lg bg-background p-6",children:[n.jsx("h3",{className:"mb-4 font-semibold text-lg",children:"Start New Chat"}),n.jsx("p",{className:"mb-4 text-muted-foreground",children:"To start a new chat, go to the Dashboard and find a user you'd like to work with."}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(A,{variant:"outline",onClick:()=>d(!1),children:"Close"}),n.jsx(A,{onClick:()=>{d(!1),window.location.href="/dashboard"},children:"Go to Dashboard"})]})]})})]})};export{ut as component};
